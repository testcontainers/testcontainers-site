{{ define "pageScripts" }}
    {{ $style := resources.Get "/sass/modules.scss" | resources.ToCSS | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">

    {{ $guidesstyle := resources.Get "/sass/guides.scss" | resources.ToCSS | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $guidesstyle.RelPermalink }}">

    {{ $script := resources.Get "/js/modules.js" | js.Build | resources.Minify }}
    <script src="{{ $script.RelPermalink }}" defer></script>
{{ end }}

{{ define "main" }}
  <main>
    <section class="modules-banner">
        <div class="container">
          <div class="content">
            <h1>{{ .Title }}</h1>
            {{ if .Description }}
              <div class="description">{{ .Description | markdownify }}</div>
            {{ end }}
            <div class="search">
              <input id="modules-search" type="text" placeholder="Search"/>
              <button type="button" id="clear-filter" disabled>Clear Filter</button>
              <button type="button" id="filter-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16">
                  <path fill="currentColor" d="M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
    </section>
    <section class="modules-list">
      <div class="container">
        <div class="filter">
            <div class="status-filter">
              <div class="filter-field">
                <input type="checkbox" id="status-official" name="status-official" class="filter-input sr-only"/>
                <label for="status-official" class="checkbox">
                  <div class="checkbox-proxy">
                    <svg width="10" height="10" viewBox="0 0 10 10">
                      <use href="#icon-check"></use>
                    </svg>
                  </div>
                  <div class="official-label">
                    <svg width="20" height="20" viewBox="0 0 30 30">
                      <use href="#icon-award"></use>
                    </svg>
                    <span>Official Modules</span>
                  </div>
                </label>
              </div>
            </div>
            <div class="language-filter">
              <h3>Languages</h3>
              <div class="filter-field">
                <input type="radio" id="language-all" name="language" class="filter-input sr-only" checked/>
                <label for="language-all" class="radio-button">
                  <span>All</span>
                </label>
              </div>
              {{ range site.Data.languages }}
                {{ if in (slice "java" "dotnet" "go" "nodejs") .slug }}
                  <div class="filter-field">
                    <input type="radio" id="language-{{ .slug }}" name="language" class="filter-input sr-only"/>
                    <label for="language-{{ .slug }}" class="radio-button">
                      <span>{{ .title }}</span>
                    </label>
                  </div>
                {{ end }}
              {{ end }}
            </div>
            <div class="category-filter">
              <h3>Categories</h3>
              <div class="filter-field">
                <input type="radio" id="category-all" name="category" class="filter-input sr-only" checked/>
                <label for="category-all" class="radio-button">
                  <span>All</span>
                </label>
              </div>
              {{ with (site.GetPage "categories") }}					
						    {{ range sort .Pages.ByWeight ".Weight" "asc" }}
                  <div class="filter-field">
                    <input type="radio" id="category-{{ .Page.Params.slug }}" name="category" class="filter-input sr-only"/>
                    <label for="category-{{ .Page.Params.slug }}" class="radio-button">
                      <span>{{ .Page.Title }}</span>
                    </label>
                  </div>
                {{ end }}
              {{ end }}
            </div>
            <div class="disclaimer">  
              <h2>
                <svg class="icon-award" width="24" height="24" viewBox="0 0 30 30">
                  <use href="#icon-award"></use>
                </svg> Official Modules</h2>
              <div>We partner with software vendors to maintain and certify official modules.</div>
            </div>
            <div class="disclaimer">  
              <h2>
                <svg class="icon-community" height="24" viewBox="0 0 40 32">
                  <use href="#icon-community"></use>
                </svg> Comunity Modules</h2>
              <div>These modules are maintained by the community, outside of the core Testcontainers project.</div>
              <div>Want to contribute? Visit the <a href="https://github.com/testcontainers/community-module-registry" target="_blank">Community module registry</a></div>
            </div>
        </div>
        <div class="content">
          <div class="modules-list-items">
            {{ range .Paginator.Pages }}
              {{ $moduleLanguages := partial "utils/module-languages" . }}
              
              {{/* Get list of language slugs */}}
              {{ $moduleLanguagesSlugs := slice }}
              {{ range $moduleLanguages }}
                {{ $moduleLanguagesSlugs = append .slug $moduleLanguagesSlugs }}
              {{ end }}

              {{/* Check if this is a community module */}}
              {{ $communityDocs := false }}
              {{ range .Params.Docs }}
                {{ if or (eq .maintainer "community") .isThirdParty }}
                  {{ $communityDocs = true }}
                {{ end }}
              {{ end }}

              <a href="{{ .RelPermalink }}" class="modules-list-item" data-filter='{{ dict "title" .Title "description" .Description "languages" $moduleLanguagesSlugs "categories" .Params.Categories "official" .Params.officialPartner | jsonify }}'> 
                {{ $logoImage := .Resources.GetMatch "logo.svg" }}
                {{ $markImage := resources.Get (printf "/images/modules/%s-mark.svg" .File.BaseFileName) }}
                {{ if $logoImage }}
                  {{- $relImage := printf "%s/%s" .RelPermalink $logoImage -}}
                  <img src="{{ $relImage }}" width="30" height="30" alt=""/>
                {{ else if $markImage }}
                  {{ partial "img.html" (dict "image" $markImage "alt" "") }}
                {{ else }}
                  {{ partial "img.html" (dict "image" (resources.Get "/images/modules/none.svg") "alt" "") }}
                {{ end }}
                
                <div class="modules-list-item-content">
                    <div class="title">
                      <h2>{{ .Title }}</h2>
                      {{ if or .Params.officialPartner .Params.isOfficial }}
                        <div class="official" title="Official Module">
                          <svg width="20" height="20" viewBox="0 0 30 30">
                            <use href="#icon-award"></use>
                          </svg>
                        </div>
                      {{ end }}
                    </div>
                    {{ if .GetTerms "categories" }}
                      <div class="categories">
                        {{ $categoriesList := (.GetTerms "categories") }}
                        {{ $categoriesListLength := (len $categoriesList) }}
                        {{ range $index, $element := $categoriesList }}
                          <span class="category">{{.Title }}{{ if lt (add $index 1) $categoriesListLength }},{{ end }}</span>
                        {{ end }}
                      </div>
                    {{ end }}
                    {{ with $moduleLanguages }}
                      <ul class="languages">
                        {{ range . }}
                          <li class="language">{{ .title }}</li>
                        {{ end }}
                      </ul>
                    {{ end }}
                </div>
              </a>
            {{ end }}
          </div>
          <div class="modules-filter-empty">
            No modules found
          </div>
        </div>
      </div>
    </section>
  </main>
{{ end }}